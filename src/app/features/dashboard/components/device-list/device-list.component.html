<div class="container">
  <!-- Sol Panel: Cihaz Listesi -->
  <div class="panel device-list-panel">
    <mat-form-field appearance="outline">
      <mat-label>Cihaz Ara...</mat-label>
      <input
        matInput
        placeholder="Seri no, şube adı veya kodu"
        [formControl]="deviceFilterControl"
      />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    @if (filteredDevices().length > 0) {
    <mat-list role="list">
      @for (device of filteredDevices(); track device.serialNo) {
      <mat-list-item
        role="listitem"
        (click)="selectDevice(device)"
        [class.selected]="selectedDevice()?.serialNo === device.serialNo"
        matTooltip="Cihaz detaylarını ve MQTT topic'lerini görmek için tıklayın."
      >
        <div class="device-info">
          <span class="serial-no">{{ device.serialNo }}</span>
          <span class="branch-name">{{ device.branchName }}</span>
        </div>
        <div class="device-status">
          <mat-icon
            [style.color]="device.isConnected ? '#4CAF50' : '#F44336'"
          >
            {{ device.isConnected ? "power" : "power_off" }}
          </mat-icon>
        </div>
      </mat-list-item>
      }
    </mat-list>
    } @else {
    <div class="empty-state">
      <mat-icon>devices_other</mat-icon>
      <p>Filtreyle eşleşen bağlı bir cihaz bulunamadı.</p>
    </div>
    }
  </div>

  <!-- Sağ Panel: Topic Detayları -->
  <div class="panel topic-details-panel">
    @if (selectedDevice(); as device) {
    <div class="topic-header">
      <h2>
        <mat-icon>hub</mat-icon>
        <span>Topic'ler: {{ device.serialNo }}</span>
      </h2>
      <mat-form-field appearance="outline">
        <mat-label>Topic Ara...</mat-label>
        <input
          matInput
          placeholder="Topic adı, türü veya açıklama"
          [formControl]="topicFilterControl"
        />
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>

    <div class="topic-list">
      @for (topic of filteredTopics(); track topic.name) {
      <div class="topic-item" [matTooltip]="topic.description">
        <span class="topic-name">{{ topic.name }}</span>
        <mat-chip-set>
          <mat-chip [ngClass]="'chip-' + topic.type">{{
            topic.type
          }}</mat-chip>
        </mat-chip-set>
      </div>
      } @empty {
      <div class="empty-state">
        <mat-icon>filter_list_off</mat-icon>
        <p>Aradığınız kriterlere uygun topic bulunamadı.</p>
      </div>
      }
    </div>
    } @else {
    <div class="empty-state placeholder">
      <mat-icon>touch_app</mat-icon>
      <h2>Detayları Görmek İçin Bir Cihaz Seçin</h2>
      <p>
        Sol taraftaki listeden bir cihaz seçerek o cihaza ait tüm MQTT
        topic'lerini burada görebilirsiniz.
      </p>
    </div>
    }
  </div>
</div>
