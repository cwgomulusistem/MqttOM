<div class="monitor-layout">
  <!-- Available Topics List -->
  <div class="topics-sidebar">
    <div class="sidebar-header">
      <mat-icon>list_alt</mat-icon>
      <h5>Available Topics</h5>
    </div>
    <mat-list>
      <!-- All Topics Option -->
      <mat-list-item
        (click)="selectTopic(null)"
        [class.selected]="selectedTopic() === null"
        matTooltip="Show messages from all subscribed topics"
      >
        <mat-icon matListItemAvatar>hub</mat-icon>
        <div matListItemLine>All Subscribed Topics</div>
      </mat-list-item>

      <!-- Topics from Selected Device -->
      @if (selectedDevice(); as device) {
        @for (topic of deviceTopics(); track topic.name) {
          <mat-list-item
            (click)="selectTopic(topic)"
            [class.selected]="selectedTopic()?.name === topic.name"
            [matTooltip]="topic.description"
            [matTooltipPosition]="'above'"
          >
            <mat-icon matListItemAvatar [ngClass]="topic.type === 'rpc' ? 'rpc-icon' : 'event-icon'">
              {{ topic.type === 'rpc' ? 'settings_ethernet' : 'dvr' }}
            </mat-icon>
            <div matListItemLine class="topic-name">{{ topic.name }}</div>
            <div matListItemMeta>
              <mat-chip-option [selected]="true" [color]="topic.type === 'rpc' ? 'accent' : 'primary'">
                {{ topic.type }}
              </mat-chip-option>
            </div>
          </mat-list-item>
        }
      } @else {
        <div class="no-device-placeholder">
          <mat-icon>phonelink_off</mat-icon>
          <p>Select a device to see its specific topics.</p>
        </div>
      }
    </mat-list>
  </div>

  <!-- Message Display Area -->
  <div class="message-area">
    <div #messageContainer class="message-container">
      @if (topicMessages().length > 0) {
        @for (msg of topicMessages(); track msg.timestamp + msg.topic) {
          <div class="message-entry">
            <div class="message-header">
              <span class="topic-name">{{ msg.topic }}</span>
              <span class="timestamp">{{ msg.timestamp | date:'HH:mm:ss.SSS' }}</span>
            </div>
            <pre class="payload">{{ msg.payload | prettyJson }}</pre>
          </div>
        }
      } @else {
        <div class="empty-state">
          @if (selectedTopic()) {
            <mat-icon>hourglass_empty</mat-icon>
            <h3>Waiting for messages...</h3>
            <p>No messages received on <strong>{{ selectedTopic()?.name }}</strong> yet.</p>
          } @else {
            <mat-icon>visibility</mat-icon>
            <h3>Select a Topic to Monitor</h3>
            <p>Choose a topic from the list on the left to see its live message stream.</p>
          }
        </div>
      }
    </div>
  </div>
</div>
