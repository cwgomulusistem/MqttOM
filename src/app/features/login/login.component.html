
<div class="login-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>MQTT Dashboard</mat-card-title>
      <mat-card-subtitle>Connect to an MQTT Broker to continue</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="loginForm" (ngSubmit)="connect()">
        <!-- Broker URL -->
        <mat-form-field appearance="outline">
          <mat-label>Broker URL</mat-label>
          <input matInput formControlName="hostname" placeholder="e.g., test.mosquitto.org" required>
          @if (loginForm.get('hostname')?.hasError('required')) {
            <mat-error>Broker URL is required</mat-error>
          }
        </mat-form-field>

        <!-- Port -->
        <mat-form-field appearance="outline">
          <mat-label>Port</mat-label>
          <input matInput formControlName="port" type="number" placeholder="e.g., 8081" required>
           @if (loginForm.get('port')?.hasError('required')) {
            <mat-error>Port is required</mat-error>
          }
           @if (loginForm.get('port')?.hasError('pattern')) {
            <mat-error>Please enter a valid port number</mat-error>
          }
        </mat-form-field>

        <!-- Username -->
        <mat-form-field appearance="outline">
          <mat-label>Username (Optional)</mat-label>
          <input matInput formControlName="username">
        </mat-form-field>

        <!-- Password -->
        <mat-form-field appearance="outline">
          <mat-label>Password (Optional)</mat-label>
          <input matInput formControlName="password" [type]="hidePassword() ? 'password' : 'text'">
        </mat-form-field>

      </form>
    </mat-card-content>

    <mat-card-actions align="end">
        <button mat-flat-button color="primary" (click)="connect()" [disabled]="!loginForm.valid || connectionState() === 'Connecting'">
            @if (connectionState() === 'Connecting') {
                <span>Connecting...</span>
            } @else {
                <span>Connect</span>
            }
        </button>
    </mat-card-actions>

     @if (connectionState() === 'Connecting') {
      <div class="spinner-overlay">
        <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
      </div>
    }
  </mat-card>
</div>
